_format_version: '3.0'

# Removed global CORS - let Storage service handle it
# plugins:
#     - name: cors
#       config:
#           ...

services:
    - name: auth
      url: http://auth:9999
      routes:
          - name: auth
            paths:
                - /auth/v1

    - name: rest
      url: http://rest:3000
      routes:
          - name: rest
            paths:
                - /rest/v1

    - name: storage
      url: http://storage:5000
      routes:
          - name: storage
            paths:
                - /storage/v1
            plugins:
                - name: cors
                  config:
                      origins:
                          - '*'
                      methods:
                          - GET
                          - HEAD
                          - PUT
                          - PATCH
                          - POST
                          - DELETE
                          - OPTIONS
                      headers:
                          - Accept
                          - Accept-Version
                          - Content-Length
                          - Content-MD5
                          - Content-Type
                          - Date
                          - X-Auth-Token
                          - Authorization
                          - apikey
                          - X-Client-Info
                          - x-upsert
                          - Range
                          - X-Requested-With
                          - cache-control
                          - x-amz-user-agent
                          - tus-resumable
                          - upload-length
                          - upload-metadata
                          - upload-offset
                          - content-encoding
                          - x-source
                      exposed_headers:
                          - X-Auth-Token
                          - Content-Range
                          - Content-Length
                          - Accept-Ranges
                          - tus-resumable
                          - tus-version
                          - tus-extension
                          - upload-offset
                          - upload-length
                          - location
                      credentials: true
                      max_age: 3600
